#!/bin/sh

SCE="$1"
TCEDIR="/etc/sysconfig/tcedir"
SCEDIR=""$TCEDIR"/sce"
SCE=${SCE%%.sce}
cd "$SCEDIR"

if [ -z "$SCE" ]; then
	## Select sces to remove on shutdown.
	cd "$SCEDIR"
	while true; do
	[ -f /tmp/.scermlist ] || ls *.sce | sed 's:.sce::' | sort > /tmp/.scermlist
	cat /tmp/.scermlist | select "Choose the sce you want to remove on shutdown." "-"
	read ANS < /tmp/select.ans
	if [ "$ANS" == "q" ]; then
		break
	fi
	grep "^$ANS$" /tmp/.sceremove > /dev/null 2>&1 || echo "$ANS" >> /tmp/.sceremove
	sed -i "/^$ANS$/d" /tmp/.scermlist
	done
else
	echo "$SCE" > /tmp/.sceremove
fi 

rmdep() {
	for D in `grep "^$1$" *.dep`; do 
		EXT0=`echo "$D" | cut -f1 -d:`
		EXT=`basename "$EXT0" .sce.dep`
		grep "^$EXT$" /tmp/.sceremove > /dev/null 2>&1 || echo "$EXT" >> /tmp/.sceremove
		rmdep "$EXT"
	done
	
}

for I in `cat /tmp/.sceremove`; do 
	ondemand -r "$I"
	rmdep "$I"	
done
echo " "
for I in `cat /tmp/.sceremove`; do
	echo "$I"
done
 
echo " "
echo "The above SCEs will be removed upon shutdown or reboot."




