#!/bin/sh

. /etc/init.d/tc-functions
SERVER="http://ppa.launchpad.net"
ENTRY=`echo "$1" | awk ' BEGIN{FS=":"} { print $2 } '`
DISTRO=`cat /usr/share/doc/tc/distro.txt`
VERSION=`cat /usr/share/doc/tc/repo.txt`
REPO="$2"
SOURCESLISTDIR="/opt/debextra"

if [ "$1" == "-h" ] || [ "$1" == "--help" ]; then
        echo
        echo "${YELLOW}ppa-add - add a PPA (Personal Package Archive) entry in /opt/debextra,"
        echo "          for use with Ubuntu based dCore ports.${NORMAL}"
        echo
        echo "${YELLOW}Ubuntu warning:${NORMAL} PPAs do not undergo the same validation process as packages in"
        echo "the main Ubuntu repositories. PPA keys are cryptographically signed but are"
        echo "still a lower security alternative to the main repository. The user will"
        echo "be installing software at their own risk."
        echo
        echo "Usage:"
        echo
        echo "${YELLOW}'ppa-add PPA_NAME'${NORMAL}  create a PPA entry in /opt/debextra, use exact PPA_NAME"
        echo "                    provided by the PPA, eg. ppa-add ppa:midori/ppa, re-run"
        echo "                    command for each PPA added, manually remove PPA entry"
        echo "                    from /opt/debextra as desired, use sce-import to"
        echo "                    install the actual extension and create an SCE,"
        echo "                    for more information on available PPA archives"
        echo "                    see https://launchpad.net/ubuntu/+ppas."
        echo
exit 1
fi

[ -d "$SOURCESLISTDIR" ] || sudo mkdir -p "$SOURCESLISTDIR"

if [ ! -n "$1" ]; then
	echo "Please specify a PPA.  Exiting.."
	exit 1
fi

if [ ! -n "$2" ]; then
	REPO=main
fi

FILE="`echo "$1" | awk ' BEGIN{FS=":"} { print $2 } ' | sed 's/\//-/g'`"
FILENAME="$FILE"-"$REPO"
if [ -f "$SOURCESLISTDIR"/"$FILENAME" ]; then
	echo ""$SOURCESLISTDIR"/"$FILENAME" already exists.  Exiting.."
	exit 1
else
	echo " "
	echo "Adding below to "$SOURCESLISTDIR"/"$FILENAME"":
	echo " "
	echo ""$SERVER"/"$ENTRY"/"$DISTRO" "$VERSION" "$REPO"" | sudo tee -a "$SOURCESLISTDIR"/"$FILENAME"
	echo " "
fi
